# WordPress 软文发布中间件 V2.4 上线检查清单

## 📋 部署前检查

### 1. 环境准备
- [ ] Python 3.7+ 已安装
- [ ] 所有依赖包已安装 (`pip install -r requirements.txt`)
- [ ] WordPress网站可正常访问
- [ ] WordPress REST API已启用
- [ ] WordPress用户具有发布权限

### 2. 配置文件检查
- [ ] `.env`文件已创建并配置完整
- [ ] WordPress连接信息正确
- [ ] 用户密码已修改（非默认密码）
- [ ] 会话密钥已设置为强随机值
- [ ] AI审核开关已根据需求设置
- [ ] 端口配置无冲突

### 3. 安全配置
- [ ] 运行安全审计脚本 (`python security_audit_v2_4.py`)
- [ ] 所有高风险问题已解决
- [ ] 文件权限设置正确
- [ ] 防火墙规则已配置
- [ ] SSL证书已配置（如使用HTTPS）

### 4. 功能测试
- [ ] 健康检查接口正常 (`/health`)
- [ ] 登录功能正常（管理员和外包用户）
- [ ] 文章发布功能正常
- [ ] 本月统计功能正常
- [ ] 发布历史功能正常（V2.4新增）
- [ ] HTML代码模式正常（V2.4新增）
- [ ] AI审核开关生效（V2.4新增）

## 🚀 部署步骤

### 1. 代码部署
```bash
# 1. 备份现有版本
python deploy_v2_4.py

# 2. 或手动部署
git pull origin main
cp .env.production .env
# 修改.env中的配置
```

### 2. 服务启动
```bash
# 开发环境
python start_v2_4.py

# 生产环境（推荐使用进程管理器）
# 方式1: systemd
sudo systemctl start wordpress-publisher-v2.4

# 方式2: supervisor
supervisorctl start wordpress-publisher-v2.4

# 方式3: PM2
pm2 start start_v2_4.py --name wordpress-publisher-v2.4
```

### 3. 反向代理配置（可选）
```bash
# Nginx配置
sudo cp nginx_v2_4.conf /etc/nginx/sites-available/wordpress-publisher
sudo ln -s /etc/nginx/sites-available/wordpress-publisher /etc/nginx/sites-enabled/
sudo nginx -t
sudo systemctl reload nginx
```

## ✅ 部署后验证

### 1. 基础功能验证
- [ ] 访问主页面 (`http://your-domain/`)
- [ ] 管理员登录测试
- [ ] 外包用户登录测试
- [ ] 发布一篇测试文章
- [ ] 检查WordPress后台是否收到文章

### 2. V2.4新功能验证
- [ ] 切换到HTML代码模式
- [ ] 在代码模式下编辑内容
- [ ] 查看发布历史面板
- [ ] 验证AI审核开关设置
- [ ] 测试富文本与代码模式同步

### 3. 性能和监控
```bash
# 运行性能监控
python monitor_v2_4.py --single

# 持续监控（可选）
python monitor_v2_4.py --interval 300
```

### 4. API接口测试
```bash
# 健康检查
curl http://your-domain/health

# API信息
curl http://your-domain/api/info

# 本月统计（需要登录）
curl -b cookies.txt http://your-domain/api/stats/monthly

# 发布历史（需要登录）
curl -b cookies.txt http://your-domain/api/publish/history
```

## 🔧 故障排除

### 常见问题及解决方案

#### 1. 服务无法启动
```bash
# 检查端口占用
netstat -tlnp | grep :8001

# 检查日志
tail -f logs/app.log

# 检查配置
python -c "from dotenv import load_dotenv; load_dotenv(); import os; print('WP_DOMAIN:', os.getenv('WP_DOMAIN'))"
```

#### 2. WordPress连接失败
- 检查WordPress域名是否可访问
- 验证用户名和应用密码
- 确认WordPress REST API已启用
- 检查防火墙和网络连接

#### 3. 登录问题
- 检查用户名密码配置
- 清除浏览器Cookie
- 检查会话密钥设置
- 验证Session存储

#### 4. 发布历史显示异常
- 检查WordPress API权限
- 验证用户角色权限
- 检查网络连接
- 查看浏览器控制台错误

#### 5. HTML代码模式问题
- 检查JavaScript文件加载
- 验证Quill编辑器初始化
- 清除浏览器缓存
- 检查控制台错误信息

## 📊 监控和维护

### 1. 日常监控指标
- 系统资源使用率（CPU、内存、磁盘）
- 应用响应时间
- API成功率
- 用户会话数量
- 发布成功率

### 2. 定期维护任务
- [ ] 每周检查系统日志
- [ ] 每月更新依赖包
- [ ] 每季度进行安全审计
- [ ] 定期备份配置文件
- [ ] 监控WordPress连接状态

### 3. 告警设置
- CPU使用率 > 80%
- 内存使用率 > 85%
- 磁盘使用率 > 90%
- 应用响应时间 > 2秒
- API错误率 > 5%

## 🔒 安全建议

### 1. 生产环境安全配置
```env
# 强密码设置
ADMIN_PASS=使用复杂密码（至少12位，包含大小写字母、数字、特殊字符）
OUTSOURCE_PASS=使用复杂密码
SESSION_SECRET_KEY=使用强随机密钥（至少32位）

# 安全选项
DEBUG=false
TEST_MODE=false
SECURE_COOKIES=true
CORS_ORIGINS=https://your-domain.com
```

### 2. 网络安全
- 使用HTTPS加密传输
- 配置防火墙规则
- 限制API访问频率
- 定期更新SSL证书

### 3. 访问控制
- 定期更换密码
- 监控登录日志
- 限制管理员账户数量
- 使用强认证令牌

## 📞 技术支持

### 联系方式
- 技术文档：README_V2.4.md
- 问题反馈：GitHub Issues
- 紧急联系：技术负责人

### 常用命令参考
```bash
# 查看服务状态
systemctl status wordpress-publisher-v2.4

# 重启服务
systemctl restart wordpress-publisher-v2.4

# 查看日志
journalctl -u wordpress-publisher-v2.4 -f

# 性能监控
python monitor_v2_4.py --single

# 安全审计
python security_audit_v2_4.py
```

---

**检查完成后，请在每个项目前打勾 ✅，确保所有步骤都已正确执行。**